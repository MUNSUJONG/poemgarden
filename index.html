<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>파이 감성정원</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
  <script>
    // Pi 앱 AIP 코드 설정
    const piAppId = "c514qbry24epcduq58dnbcslv3d2wpk8y3dyjirlamzmraqctfowk1sp8upbsczi";

    // Pi 로그인
    async function piLogin() {
      try {
        const scopes = ['username', 'payments'];
        const authResult = await window.Pi.authenticate(scopes, onIncompletePaymentFound);
        alert("로그인 완료! 사용자명: " + authResult.user.username);
      } catch (error) {
        console.error("로그인 오류:", error);
      }
    }

    // 결제 처리
    async function makePayment() {
      const paymentData = {
        amount: 0.01,
        memo: "감성정원 결제",
        metadata: { type: "test-payment" }
      };
      try {
        const payment = await window.Pi.createPayment(paymentData, {
          onReadyForServerApproval: function(paymentId) {
            console.log("서버 승인 필요:", paymentId);
            // 여기에 서버 승인 로직 추가
          },
          onIncompletePaymentFound: onIncompletePaymentFound,
          onCancelled: function(paymentId) {
            alert("결제가 취소되었습니다.");
          },
          onError: function(error, payment) {
            console.error("결제 오류:", error);
          }
        });
      } catch (err) {
        console.error(err);
      }
    }

    function onIncompletePaymentFound(payment) {
      console.log("미완료 결제 발견:", payment);
    }
  </script>
</head>
<body style="background-color: #fff0f5; text-align: center; padding: 50px; font-family: 'Arial', sans-serif;">
  <h1 style="color: #c2185b;">🌸 파이 감성정원 🌸</h1>
  <p>0.01π 테스트 결제를 진행해보세요.</p>
  <button onclick="piLogin()" style="padding: 12px 20px; margin: 10px; font-size: 16px;">🧑‍💻 Pi 로그인</button>
  <button onclick="makePayment()" style="padding: 12px 20px; font-size: 16px;">💳 결제하기</button>
</body>
</html>
