<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸŒ¸ íŒŒì´ ê°ì„±ì •ì› ğŸŒ¸</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body style="background-color:#fff8f0; font-family: sans-serif; text-align: center; padding: 50px;">
  <h1 style="color: #c2185b;">ğŸŒ¸ íŒŒì´ ê°ì„±ì •ì› ğŸŒ¸</h1>
  <p>0.01Ï€ í…ŒìŠ¤íŠ¸ ê²°ì œë¥¼ ì§„í–‰í•´ë³´ì„¸ìš”.</p>

  <button id="pi-login">Pi ë¡œê·¸ì¸</button>
  <button id="pay-button">ê²°ì œí•˜ê¸°</button>

  <script>
    Pi.init({ version: "2.0", sandbox: true });

    document.getElementById("pi-login").addEventListener("click", async () => {
      try {
        const scopes = ["username", "payments"];
        const result = await Pi.authenticate(scopes, function onIncompletePaymentFound(payment) {
          console.log("ì´ì „ ê²°ì œ ë°œê²¬ë¨:", payment);
        });
        console.log("ë¡œê·¸ì¸ ê²°ê³¼:", result);
      } catch (err) {
        console.error("ë¡œê·¸ì¸ ì˜¤ë¥˜:", err);
      }
    });

    document.getElementById("pay-button").addEventListener("click", async () => {
      try {
        const paymentData = {
          amount: 0.01,
          memo: "íŒŒì´ ê°ì„±ì •ì› í…ŒìŠ¤íŠ¸ ê²°ì œ",
          metadata: { project: "poemgarden-v2" }
        };

        const payment = await Pi.createPayment(paymentData, {
          onReadyForServerApproval: function(paymentId) {
            fetch("https://pi-server-poemgarden.onrender.com/approve", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ paymentId })
            });
          },
          onReadyForServerCompletion: function(paymentId, txid) {
            fetch("https://pi-server-poemgarden.onrender.com/complete", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ paymentId, txid })
            });
          },
          onCancel: function(paymentId) {
            console.log("ê²°ì œ ì·¨ì†Œë¨:", paymentId);
          },
          onError: function(error, payment) {
            console.error("ê²°ì œ ì˜¤ë¥˜ ë°œìƒ:", error);
          }
        });

        console.log("ê²°ì œ ì‹œì‘:", payment);
      } catch (err) {
        console.error("ê²°ì œ ì‹¤íŒ¨:", err);
      }
    });
  </script>
</body>
</html>
